{% extends 'base.html' %} 
{% load static %} 
{% load basket_tools %} 
{% block content %} 

{% if basket_items %}

<main class="container">
  <section class="section">
    <table class="table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        {% for item in basket_items %}
        <tr>
          <td class="is-vcentered">
            
            <a href="{{item.product.get_url}}">
              <article class="is-flex">
                <figure class="media-left">
                  <p class="image is-96x96">
                    <img
                      src="{{item.product.image.url}}"
                      alt="{{item.product.name}}"
                    >
                  </p>
                </figure>
                <div class="media-content level-item">
                  <div class="content">
                    <p>{{item.product.name}}</p>
                    
                  </div>
                </div>
              </article> 
            </a>
          </td>
          <td class="is-vcentered">
            <p class="has-text-weight-bold">£ {{item.product.price}}</p>
          </td>
          <td class="is-vcentered">
            <form
            action="{% url 'adjust_basket' item.product.id %}"
            method="POST"
            id="basket-quantity-form-{{item.product.id}}"
            x-data="qtyFormControl()"
            class="control qty-form"
            
          >
          {% csrf_token %}
            <div class="field has-addons">
              <div class="control">
                <button
                  @click.prevent="decrementQty({{item.product.id}})"
                  class="button is-rounded is-icon is-primary" 
                  id="decrement-{{item.product.id}}"
                  {% if item.quantity == 1 %}
                  disabled=""
                  {% endif %}
                >
                  <span class="icon">
                    <i class="fas fa-minus"></i>
                  </span>
                </button>
              </div>
              <div class="control qty-input">
                <input
                  type="number"
                  name="quantity"
                  value="{{item.quantity}}"
                  min="1"
                  max="{{item.product.stock}}"
                  class="input is-primary"
                  id="qty-{{item.product.id}}"
                  x-on:keypress="blockAlpha($event)"
                  x-on:keyup="updateSubmitForm({{item.product.id}})"
                />
              </div>
              <div class="control">
                <button
                  @click.prevent="incrementQty({{item.product.id}})"
                  class="button is-rounded is-icon is-primary"
                  id="increment-{{item.product.id}}"
                >
                  <span class="icon">
                    <i class="fas fa-plus"></i>
                  </span>
                </button>
              </div>
            </div>
            
          </form>
          </td>
          <td class="is-vcentered">
            <p class="has-text-weight-bold">£ {{item.product.price | calc_subtotal:item.quantity}}</p>
          </td>
          <td class="is-vcentered">
            <a href="{% url 'remove_from_basket' item.product.id %}"><span class="icon"><i class="fas fa-trash"></i></span></a>
          </td>
        </tr>
        
        {% endfor %}
      </tbody>
    </table>
  </section>
</main>
    

{% endif %}

{% endblock content %}

{% block postloadjs %}
{{ block.super }}
<script type="text/javascript" src="{% static 'js/qtyFormControl.js' %}"></script>
{% endblock postloadjs %}
  